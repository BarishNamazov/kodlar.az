---
import Icon from "./Icon.astro";

interface Props {
  categories: string[];
  selected?: string[];
  showAll?: boolean;
}

const { categories, selected = [], showAll = false } = Astro.props;

// Fully dynamic color generation - no hardcoded categories
function getCategoryStyle(cat: string): {
  bg: string;
  text: string;
  hue: number;
} {
  // Generate a unique hue from the category name
  let hash = 0;
  for (let i = 0; i < cat.length; i++) {
    hash = cat.charCodeAt(i) + ((hash << 5) - hash);
  }

  // Create beautiful color palette with good saturation and lightness
  const hue = Math.abs(hash) % 360;
  const saturation = 75 + (Math.abs(hash) % 15); // 75-90%
  const lightness = 45 + (Math.abs(hash) % 10); // 45-55%

  return {
    hue,
    bg: `hsla(${hue}, ${saturation}%, ${lightness}%, 0.12)`,
    text: `hsl(${hue}, ${saturation}%, ${lightness - 5}%)`,
  };
}

// Get icon based on category name keywords
function getCategoryIcon(cat: string): string {
  const lower = cat.toLowerCase();
  if (
    lower.includes("python") ||
    lower.includes("c++") ||
    lower.includes("java") ||
    lower.includes("code")
  )
    return "code";
  if (lower.includes("algor") || lower.includes("dp")) return "algorithm";
  if (lower.includes("math") || lower.includes("riyaz")) return "math";
  if (lower.includes("qraf") || lower.includes("graph")) return "share";
  if (lower.includes("olimp") || lower.includes("yarış")) return "trophy";
  if (lower.includes("karyer") || lower.includes("iş")) return "star";
  return "tag";
}

const displayCategories = showAll ? categories : categories.slice(0, 8);
---

<div class="category-tags-container">
  {
    displayCategories.map((cat) => {
      const style = getCategoryStyle(cat);
      const icon = getCategoryIcon(cat);
      const isSelected = selected.includes(cat);

      return (
        <button
          class:list={["category-pill", { selected: isSelected }]}
          style={`--pill-bg: ${style.bg}; --pill-text: ${style.text}; --pill-hue: ${style.hue}`}
          data-category={cat}
        >
          <Icon name={icon} size={14} />
          <span>{cat}</span>
        </button>
      );
    })
  }

  {
    !showAll && categories.length > 8 && (
      <button class="category-pill more-btn">
        <span>+{categories.length - 8}</span>
      </button>
    )
  }
</div>

<style>
  .category-tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.625rem;
  }

  .category-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.125rem;
    font-size: 0.8125rem;
    font-weight: 600;
    background: var(--pill-bg);
    color: var(--pill-text);
    border: 2px solid transparent;
    border-radius: 100px;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .category-pill::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      hsla(var(--pill-hue), 80%, 60%, 0) 0%,
      hsla(var(--pill-hue), 80%, 60%, 0.1) 100%
    );
    opacity: 0;
    transition: opacity 0.25s;
  }

  .category-pill:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px -4px var(--pill-bg);
  }

  .category-pill:hover::before {
    opacity: 1;
  }

  .category-pill.selected {
    border-color: var(--pill-text);
    box-shadow: 0 4px 16px -2px var(--pill-bg);
  }

  .more-btn {
    --pill-bg: rgba(0, 0, 0, 0.04);
    --pill-text: var(--color-text-muted);
    padding: 0.625rem 1rem;
    border: 2px dashed rgba(0, 0, 0, 0.15);
    font-weight: 700;
  }

  .more-btn:hover {
    --pill-bg: rgba(102, 126, 234, 0.1);
    --pill-text: #667eea;
    border-color: #667eea;
    border-style: solid;
  }
</style>
